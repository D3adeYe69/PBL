<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <title>Sign Up</title>
    <style>
      body {
        font-family: "Crimson Text", serif;
      }
    </style>
  </head>
  <body>
    <div class="screen bg-gradient-to-t from-pink-300 to-white h-screen">
      <div
        class="bot-container flex flex-col justify-end items-center h-screen pb-[40%] gap-7"
      >
        <div class="titles mb-4 text-center">
          <div class="title text-[#c22165] text-6xl mb-3 font-bold">
            Welcome
          </div>
          <div class="subtitle text-[#c94a80] text-2xl mb-4 font-bold">
            Start the Adventure
          </div>
        </div>
        <div class="inputs flex flex-col items-center justify-center gap-2">
          <div class="input">
            <input
              id="username"
              type="text"
              placeholder="User"
              class="bg-[#fec6ee] text-[#c22165] focus:placeholder-transparent focus:border-pink-600 focus:outline-none text-xl font-bold placeholder-[#c22165] px-5 py-2 text-center rounded-md font-bold border border-pink-400"
              required
            />
          </div>
          <div class="input">
            <input
              id="email"
              type="email"
              placeholder="Email"
              class="bg-[#fec6ee] text-[#c22165] text-xl focus:outline-none focus:border-pink-600 focus:placeholder-transparent placeholder-[#c22165] px-5 py-2 text-center font-bold border border-pink-400 rounded-md"
              required
            />
          </div>
          <div class="input">
            <input
              id="password"
              type="password"
              placeholder="Password"
              class="bg-[#fec6ee] text-[#c22165] focus:placeholder-transparent focus:border-pink-600 focus:outline-none text-xl font-bold placeholder-[#c22165] px-5 py-2 text-center rounded-md font-bold border border-pink-400"
              required
            />
          </div>
          <div class="input">
            <input
              id="confirmPassword"
              type="password"
              placeholder="Confirm Password"
              class="bg-[#fec6ee] text-[#c22165] focus:placeholder-transparent focus:border-pink-600 focus:outline-none text-xl font-bold placeholder-[#c22165] px-5 py-2 text-center rounded-md font-bold border border-pink-400"
              required
            />
          </div>
        </div>
        <div
          id="signupButton"
          class="button bg-[#c22165] mt-2 inline-flex text-xl justify-center items-center px-14 py-1.5 rounded-md cursor-not-allowed opacity-50"
        >
          <span class="text-[#fec6ee]">Sign up</span>
        </div>
        <div
          id="generalError"
          class="text-red-500 text-sm hidden mt-2 text-center"
        ></div>
      </div>
    </div>

    <script>
      const inputs = document.querySelectorAll("input");
      const signupButton = document.getElementById("signupButton");
      const generalError = document.getElementById("generalError");

      inputs.forEach((input) => {
        input.addEventListener("input", checkFields);
      });

      function checkFields() {
        let allFilled = true;
        hideErrorMessages();
        generalError.classList.add("hidden"); // Hide general error message

        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const email = document.getElementById("email").value;

        if (username.length < 3) {
          showError("Username must be at least 3 characters long.");
          allFilled = false;
        }
        if (!isValidEmail(email)) {
          showError("Invalid email address.");
          allFilled = false;
        }
        if (password.length < 6) {
          showError("Password must be at least 6 characters long.");
          allFilled = false;
        }
        if (password !== confirmPassword) {
          showError("Passwords do not match.");
          allFilled = false;
        }

        toggleButton(allFilled);
      }

      function toggleButton(enable) {
        if (enable) {
          signupButton.classList.remove("cursor-not-allowed", "opacity-50");
          signupButton.classList.add("cursor-pointer", "opacity-100");
          signupButton.onclick = () => {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const email = document.getElementById("email").value;

            fetch("/add_user", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
              body: new URLSearchParams({
                username: username,
                password: password,
                email: email,
              }),
            })
              .then((response) => {
                if (response.ok) {
                  return response.json();
                } else {
                  return response.json().then((text) => {
                    throw new Error(text.error);
                  });
                }
              })
              .then((data) => {
                if (data.success) {
                  window.location.href = "/"; // Redirect to the index page
                }
              })
              .catch((error) => {
                showError(error.message);
              });
          };
        } else {
          signupButton.classList.add("cursor-not-allowed", "opacity-50");
          signupButton.classList.remove("cursor-pointer", "opacity-100");
          signupButton.onclick = null;
        }
      }

      function showError(message) {
        generalError.textContent = message; // Set the error message
        generalError.classList.remove("hidden"); // Show the error message
      }

      function hideErrorMessages() {
        generalError.classList.add("hidden"); // Hide general error message
      }

      function isValidEmail(email) {
        return /\S+@\S+\.\S+/.test(email); // Simple email regex
      }
    </script>
  </body>
</html>
